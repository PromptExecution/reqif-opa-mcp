## Codebase Patterns
- Ralph workflow: read prd.json → pick highest priority incomplete story → implement → commit → update PRD → append to progress.txt
- Use Python for Ralph automation scripts (issue fetching, prd conversion, archival)
- GitHub CLI (`gh`) used for issue management and PR creation
- Conventional commits format: `<type>(<scope>): <description>` where scope is user story ID
- Archive completed PRDs to ralph/.archive/ with timestamp before starting new work
- Progress learnings should consolidate reusable patterns at the top
- Ralph instructions stored in CLAUDE.md for Claude Code to read

---

## 2026-01-31 16:36 - US-001
- Implemented archive_prd.py script for archiving completed prd.json files
- Files changed: ralph/archive_prd.py (new)
- **Learnings for future iterations:**
  - Archive script validates all user stories have `passes: true` before archiving
  - Filename format: `prd-YYYYMMDD-HHMMSS-project-name.json` (kebab-cased)
  - .archive/ directory already exists and is in .gitignore
  - Used returns module pattern for error handling (will be consistent across Ralph scripts)
  - Type hints with mypy --strict passes, ruff linting passes
  - Script is executable standalone: `python3 ralph/archive_prd.py`
---

## 2026-01-31 17:34 - US-003
- Implemented fetch_github_issue.py script for fetching open GitHub issues
- Files changed: ralph/fetch_github_issue.py (new)
- **Learnings for future iterations:**
  - gh CLI version 2.31.0 doesn't support --order/--sort flags
  - Workaround: fetch more issues (limit 100) and sort in Python by createdAt
  - Script checks for gh CLI installation and authentication before proceeding
  - Exit codes: 0 for success/no issues, 1 for errors
  - Clear error messages guide users to install gh or run `gh auth login`
  - Type hints with mypy --strict passes, ruff linting passes
  - Script outputs issue JSON to stdout for downstream processing
---

## 2026-01-31 18:15 - US-004
- Implemented convert_issue_to_prd.py script for converting GitHub issues to prd.json format
- Files changed: ralph/convert_issue_to_prd.py (new)
- **Learnings for future iterations:**
  - Regex patterns parse user stories from multiple formats: `### US-XXX:`, `**US-XXX:**`, `## US-XXX:`
  - Acceptance criteria extracted from checklist items `- [ ]` and `- [x]`
  - Script merges issue body and all comments for comprehensive parsing
  - If no explicit user stories found, creates single story from issue body
  - Branch naming convention: `gh-issue-{number}-{title-kebab-case}`
  - github_issue property added to prd.json for traceability (number, url, title)
  - Script accepts input from stdin or file path argument
  - Uses subprocess to call `gh repo view` for repository slug
  - Type hints with mypy --strict passes, ruff linting passes
  - Tested with sample issue data - correctly parsed 3 user stories with acceptance criteria
---

## 2026-01-31 17:40 - US-005
- Created comprehensive ralph/README.md documenting Ralph++ workflow
- Files changed: ralph/README.md (new), ralph/check_prd.py (ruff fix)
- **Learnings for future iterations:**
  - README documents complete Ralph++ workflow: local prd → GitHub issues → exit
  - Includes 11 sections: How Ralph Works, Backlog Workflow, Archive Management, Conventional Commits, PR Creation, Progress Logging, Automation Scripts, GitHub Issue Template, Troubleshooting, Quality Requirements, Exit Conditions
  - Archive Management section includes directory structure and ls examples
  - Backlog Workflow explains priority order: local prd.json > GitHub issues > clean exit
  - Fixed ruff linting issues (removed unnecessary f-string prefixes in check_prd.py)
  - Documentation now serves as comprehensive reference for developers and Claude Code
  - All acceptance criteria met: archival steps, backlog workflow, archive management examples
---

## 2026-01-31 - US-007
- Implemented commit_formatter.py utility for generating conventional commit messages
- Files changed: ralph/commit_formatter.py (new), ralph/README.md (updated), CLAUDE.md (updated)
- **Learnings for future iterations:**
  - commit_formatter.py automatically generates properly formatted conventional commits from prd.json
  - Usage: `git commit -m "$(uv run python ralph/commit_formatter.py US-XXX)"`
  - Utility infers commit type (feat/fix/docs/chore) from user story title keywords
  - Automatically includes acceptance criteria in body, co-author footer, and GitHub issue closure
  - Subject line capped at 72 characters with truncation if needed
  - Uses returns module for error handling, passes mypy --strict and ruff checks
  - README.md Automation Scripts section updated with commit_formatter.py usage
  - CLAUDE.md updated with commit formatter utility documentation in Ralph++ section
  - Pattern: Use `uv run python` to execute scripts with proper dependency context
---

## 2026-01-31 - US-008
- Implemented create_pr.py script for automatic GitHub PR creation
- Files changed: ralph/create_pr.py (new), ralph/prd.json (updated)
- **Learnings for future iterations:**
  - create_pr.py automatically creates PRs when all user stories complete (`passes: true`)
  - Usage: `uv run python ralph/create_pr.py [prd-path]` (defaults to ralph/prd.json)
  - PR type (feat/fix/docs/chore) inferred from user story titles
  - PR body includes completed user story summary, test results, and GitHub issue closure
  - Script checks gh CLI availability and authentication before attempting PR creation
  - Auto-detects default branch (main/master) using `git remote show origin`
  - Prevents PR creation if currently on default branch (main/master)
  - Returns PR URL on success for tracking
  - Uses returns module for error handling, passes mypy --strict and ruff checks
  - Error messages guide users to install gh CLI or run `gh auth login` if needed
  - Pattern: Use subprocess.run with timeout for external command execution
---

## 2026-01-31 - US-009
- Implemented check_backlog.py script for graceful backlog-clear exit
- Files changed: ralph/check_backlog.py (new), ralph/README.md (updated)
- **Learnings for future iterations:**
  - check_backlog.py provides clean exit when backlog is clear (no local prd.json + no open issues)
  - Script checks local prd.json first, then GitHub issues via gh CLI
  - Exit codes: 0 (backlog clear), 1 (work remaining), 2 (error)
  - Includes archived PRD count in backlog clear message for visibility
  - Uses NoReturn type hint for exit functions (all exit paths must call sys.exit)
  - Match statement requires explicit _ case for mypy --strict compliance
  - README.md updated with check_backlog.py usage and exit code documentation
  - Pattern: Check local state before external APIs for better performance
---

## 2026-01-31 - US-010
- Created GitHub issue template for Ralph compatibility
- Files changed: .github/ISSUE_TEMPLATE/ralph-feature.md (new)
- **Learnings for future iterations:**
  - GitHub issue templates use YAML frontmatter for metadata (name, about, title, labels)
  - Template includes comprehensive documentation in HTML comments for user guidance
  - Ralph compatibility notes embedded in template explain parsing rules and workflow
  - User story format documented with examples: `### US-XXX: Title` with acceptance criteria
  - Acceptance criteria use GitHub checklist format: `- [ ]` for unchecked items
  - Template is selectable when creating new issue on GitHub (shows in dropdown)
  - Example user stories (US-001, US-002) demonstrate proper structure
  - Comments at bottom explain Ralph workflow: branch naming, conventional commits, auto PR creation
  - Pattern: Keep templates user-friendly while encoding structural requirements for automation
---

## 2026-01-31 - US-011
- Implemented log_issue_completion.py script for logging issue completion to progress.txt
- Files changed: ralph/log_issue_completion.py (new), ralph/README.md (updated)
- **Learnings for future iterations:**
  - log_issue_completion.py appends completion summary when all user stories from GitHub issue are done
  - Script reads prd.json github_issue property to get issue number and title
  - Includes timestamp, total stories, files changed count (via git diff), PR link, branch name
  - Uses git diff main...HEAD (or master...HEAD) to count changed files
  - Completion log format: `## ISSUE #<number> COMPLETE - <title>` with details and `---` separator
  - Script validates PRD has github_issue property (ensures it's from GitHub issue, not manual PRD)
  - Exit codes: 0 for success, 1 for errors (file not found, missing github_issue, etc.)
  - Uses returns module for error handling, passes mypy --strict and ruff checks
  - README.md Automation Scripts section updated with log_issue_completion.py entry
  - Pattern: Issue completion logs provide audit trail in progress.txt for historical tracking
---
## 2026-01-31 22:12 - US-004
- Added ralph/file_manager.py with PRD/progress helpers (read_prd, get_current_branch, initialize_progress_file, append_to_progress)
- Files changed: ralph/file_manager.py (new), ralph/prd.json (updated)
- **Learnings for future iterations:**
  - Use returns Result/Option types for file operations to keep error handling consistent
  - Anchor PRD/progress paths to the ralph package directory for stable resolution
  - append_to_progress ensures progress file exists and appends a trailing newline
---
